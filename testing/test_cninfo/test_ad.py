import pytest
from cnswd.cninfo.databrowser import AdvanceSearcher


@pytest.fixture
def pageapi():
    with AdvanceSearcher(False) as api:
        yield api


@pytest.mark.parametrize("level, start, end, expected_rows", [
    ('2.1', '2019-04-01', '2019-06-30', 110),
    ('2.2', '2019-04-01', '2019-06-30', 5175),
    ('2.3', '2019-04-01', '2019-06-30', 3449),
    ('2.4', '2019-04-01', '2019-06-30', 5429),
    ('2.5', '2019-04-01', '2019-06-30', 3737),
    ('3', '2019-04-01', '2019-06-30', 17682),
    ('4.1', '2019-04-01', '2019-06-30', 1905),
    # 全年
    ('5', '2018-01-01', '2018-12-31', 7322),
    # 期间
    ('6.1', '2019-04-01', '2019-06-30', 181),
    ('6.2', '2019-04-01', '2019-06-30', 134),
    ('6.3', '2019-04-01', '2019-06-30', 12),
    ('6.4', '2019-04-01', '2019-06-30', 5),
    # 季度财报
    ('7.1.1', '2019-04-01', '2019-06-30', 3895),
    ('7.1.2', '2019-04-01', '2019-06-30', 3895),
    # 网站bug 三张表应该一致 行数统一才对
    ('7.1.3', '2019-04-01', '2019-06-30', 3894),
    ('7.2.1', '2019-04-01', '2019-06-30', 3893),
    ('7.2.2', '2019-04-01', '2019-06-30', 3946),
    ('7.3.1', '2019-04-01', '2019-06-30', 3692),
    ('7.3.2', '2019-04-01', '2019-06-30', 3692),
    ('7.3.3', '2019-04-01', '2019-06-30', 3692),
    ('7.4.1', '2019-04-01', '2019-06-30', 3737),
    ('7.4.2', '2019-04-01', '2019-06-30', 3737),
])
def test_fetch_data(pageapi, level, start, end, expected_rows):
    df = pageapi.get_data(level, start, end)
    assert len(df) == expected_rows
